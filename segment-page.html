<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.T.L.A.S | Growity AI Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-card: #1a1a24; --accent-blue: #00d4ff; --accent-purple: #7c3aed; --accent-green: #10b981; --accent-yellow: #f59e0b; --text-primary: #f0f0f5; --text-secondary: #8888a0; --border-color: #2a2a3a; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Sora', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .bg-grid { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-image: linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px); background-size: 50px 50px; pointer-events: none; z-index: 0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px 24px; position: relative; z-index: 1; }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border-color); }
        .logo { display: flex; align-items: center; gap: 16px; }
        .logo-icon { width: 56px; height: 56px; }
        .logo-icon svg { width: 100%; height: 100%; }
        /* Globe animations */
        .globe-outer { animation: rotateRing 20s linear infinite; transform-origin: center; }
        .globe-mid { animation: rotateRing 15s linear infinite reverse; transform-origin: center; }
        .globe-inner { animation: pulseRing 3s ease-in-out infinite; transform-origin: center; }
        .globe-lat { animation: wobbleLat 8s ease-in-out infinite; transform-origin: center; }
        .globe-long { animation: wobbleLong 10s ease-in-out infinite; transform-origin: center; }
        .globe-center { animation: centerPulse 2s ease-in-out infinite; transform-origin: center; }
        .cardinal-point:nth-child(1) { animation: orbitTop 8s ease-in-out infinite; transform-origin: 28px 28px; }
        .cardinal-point:nth-child(2) { animation: orbitRight 10s ease-in-out infinite; transform-origin: 28px 28px; }
        .cardinal-point:nth-child(3) { animation: orbitBottom 7s ease-in-out infinite; transform-origin: 28px 28px; }
        .cardinal-point:nth-child(4) { animation: orbitLeft 9s ease-in-out infinite; transform-origin: 28px 28px; }
        .seg-1 { animation: floatSeg1 6s ease-in-out infinite; }
        .seg-2 { animation: floatSeg2 7s ease-in-out infinite; }
        .seg-3 { animation: floatSeg3 5s ease-in-out infinite; }
        .seg-4 { animation: floatSeg4 8s ease-in-out infinite; }
        @keyframes rotateRing { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulseRing { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.08); opacity: 0.8; } }
        @keyframes wobbleLat { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(1.15); } }
        @keyframes wobbleLong { 0%, 100% { transform: scaleX(1); } 50% { transform: scaleX(1.15); } }
        @keyframes centerPulse { 0%, 100% { transform: scale(1); filter: drop-shadow(0 0 4px rgba(0,212,255,0.6)); } 50% { transform: scale(1.2); filter: drop-shadow(0 0 10px rgba(124,58,237,0.8)); } }
        @keyframes orbitTop { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(8px, 5px) scale(1.15); } }
        @keyframes orbitRight { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-6px, 8px) scale(1.1); } }
        @keyframes orbitBottom { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-8px, -5px) scale(1.2); } }
        @keyframes orbitLeft { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(6px, -8px) scale(1.1); } }
        @keyframes floatSeg1 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-4px, 3px) scale(1.2); } }
        @keyframes floatSeg2 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(4px, -4px) scale(1.15); } }
        @keyframes floatSeg3 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(5px, 3px) scale(1.25); } }
        @keyframes floatSeg4 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-3px, -5px) scale(1.1); } }
        .logo-text { display: flex; flex-direction: column; }
        .logo-text .brand { font-family: 'Outfit', sans-serif; font-size: 26px; font-weight: 800; letter-spacing: 2px; background: linear-gradient(135deg, #00d4ff 0%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1.2; }
        .logo-text .tagline { font-size: 9px; font-family: 'Space Mono', monospace; color: var(--text-secondary); letter-spacing: 0.3px; margin-top: 2px; }
        .logo-text .powered-by { display: flex; align-items: center; gap: 6px; font-size: 9px; color: var(--text-secondary); margin-top: 6px; padding-top: 6px; border-top: 1px solid var(--border-color); }
        .logo-text .powered-by .growity-name { font-weight: 600; background: linear-gradient(90deg, #E91E8C, #7B2D8E); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-nav { display: flex; gap: 10px; }
        .nav-link { padding: 10px 16px; border: 1px solid var(--border-color); border-radius: 10px; background: var(--bg-card); color: var(--text-primary); font-size: 12px; text-decoration: none; transition: all 0.3s; }
        .nav-link:hover { border-color: var(--accent-blue); }
        .nav-link.po { border-color: rgba(227,30,36,0.4); color: #e31e24; }
        .nav-link.enerjisa { border-color: rgba(255,193,7,0.4); color: #ffc107; }
        .onboarding-toggle { display: none; padding: 10px 16px; background: linear-gradient(135deg, rgba(0,212,255,0.1), rgba(124,58,237,0.1)); border: 1px solid rgba(0,212,255,0.3); border-radius: 10px; color: var(--accent-blue); font-size: 12px; cursor: pointer; margin-bottom: 16px; }
        .onboarding-toggle.visible { display: inline-flex; align-items: center; gap: 8px; }
        .onboarding { background: linear-gradient(135deg, rgba(0,212,255,0.08), rgba(124,58,237,0.08)); border: 1px solid rgba(0,212,255,0.2); border-radius: 16px; padding: 24px; margin-bottom: 24px; }
        .onboarding.hidden { display: none; }
        .onboarding-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .onboarding-title { font-size: 18px; font-weight: 600; }
        .onboarding-title span { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .onboarding-dismiss { padding: 6px 12px; background: transparent; border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-secondary); font-size: 11px; cursor: pointer; }
        .steps { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .step { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 18px; position: relative; }
        .step.active { border-color: var(--accent-green); background: rgba(16,185,129,0.1); }
        .step-number { position: absolute; top: -10px; left: 18px; width: 24px; height: 24px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; }
        .step.active .step-number { background: linear-gradient(135deg, var(--accent-green), #059669); }
        .step-icon { width: 40px; height: 40px; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(0,212,255,0.1), rgba(124,58,237,0.1)); border-radius: 10px; }
        .step-icon svg { width: 20px; height: 20px; stroke: var(--accent-blue); }
        .step.active .step-icon { background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(5,150,105,0.1)); }
        .step.active .step-icon svg { stroke: var(--accent-green); }
        .step-title { font-size: 13px; font-weight: 600; margin-bottom: 6px; }
        .step-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }
        .step-check { position: absolute; top: 12px; right: 12px; width: 20px; height: 20px; background: var(--accent-green); border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 12px; }
        .step.completed .step-check { display: flex; }
        .quick-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
        .quick-action { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s; text-align: center; }
        .quick-action:hover { border-color: var(--accent-blue); transform: translateY(-2px); }
        .quick-action-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin: 0 auto 12px; }
        .quick-action-icon.awareness { background: rgba(124,58,237,0.2); }
        .quick-action-icon.consideration { background: rgba(245,158,11,0.2); }
        .quick-action-icon.conversion { background: rgba(16,185,129,0.2); }
        .quick-action-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .quick-action-count { font-size: 11px; color: var(--text-secondary); font-family: 'Space Mono', monospace; }
        .quick-action.active { border-color: var(--accent-green); background: rgba(16,185,129,0.1); }
        .meta-panel { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px 20px; margin-bottom: 20px; }
        .meta-panel-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
        .meta-panel-title { font-size: 13px; font-weight: 600; color: var(--accent-blue); display: flex; align-items: center; gap: 8px; }
        .meta-status { font-size: 10px; padding: 4px 10px; border-radius: 12px; font-family: 'Space Mono', monospace; background: rgba(255,255,255,0.05); color: var(--text-secondary); }
        .meta-status.connected { background: rgba(52,211,153,0.15); color: #34d399; }
        .meta-status.loading { background: rgba(251,191,36,0.15); color: #fbbf24; }
        .meta-controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .meta-input { padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px; width: 200px; }
        .meta-input:focus { outline: none; border-color: var(--accent-blue); }
        .meta-btn { padding: 8px 14px; background: linear-gradient(135deg, #1877f2, #0d65d9); border: none; border-radius: 8px; color: white; font-size: 11px; font-weight: 500; cursor: pointer; }
        .meta-btn:hover { transform: translateY(-1px); }
        .meta-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .meta-btn.purple { background: linear-gradient(135deg, #7c3aed, #6d28d9); }
        .meta-btn.green { background: linear-gradient(135deg, #10b981, #059669); }
        .meta-count { font-size: 10px; color: var(--text-secondary); font-family: 'Space Mono', monospace; }
        #interestResults { display: none; margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 12px; max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color); }
        .ai-suggestions { display: none; margin-top: 16px; background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(236,72,153,0.1)); border: 1px solid rgba(124,58,237,0.3); border-radius: 12px; padding: 16px; }
        .ai-suggestions.visible { display: block; }
        .ai-suggestions-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 10px; }
        .ai-suggestions-title { font-size: 13px; font-weight: 600; color: var(--accent-purple); display: flex; align-items: center; gap: 8px; }
        .ai-suggestions-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .suggestions-list { display: flex; flex-direction: column; gap: 8px; max-height: 300px; overflow-y: auto; }
        .suggestion-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; gap: 10px; }
        .suggestion-item.accepted { border-color: var(--accent-green); background: rgba(16,185,129,0.1); }
        .suggestion-item.loading { opacity: 0.6; }
        .suggestion-left { display: flex; align-items: center; gap: 10px; flex: 1; flex-wrap: wrap; }
        .suggestion-segment { font-size: 12px; font-weight: 500; min-width: 150px; }
        .suggestion-arrow { color: var(--text-secondary); }
        .suggestion-interest { font-size: 12px; color: var(--accent-blue); }
        .suggestion-size { font-size: 10px; color: var(--accent-green); font-family: 'Space Mono', monospace; }
        .suggestion-actions { display: flex; gap: 6px; }
        .suggestion-btn { padding: 6px 12px; border: none; border-radius: 6px; font-size: 10px; font-weight: 500; cursor: pointer; }
        .suggestion-btn.accept { background: var(--accent-green); color: white; }
        .suggestion-btn.skip { background: var(--bg-secondary); color: var(--text-secondary); border: 1px solid var(--border-color); }
        .suggestion-status { font-size: 10px; color: var(--accent-green); font-weight: 500; }
        .meta-reach { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; background: linear-gradient(135deg, rgba(24,119,242,0.15), rgba(24,119,242,0.05)); border: 1px solid rgba(24,119,242,0.25); border-radius: 10px; font-size: 9px; font-family: 'Space Mono', monospace; color: #60a5fa; }
        .meta-reach.loaded { color: #34d399; border-color: rgba(52,211,153,0.3); background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(52,211,153,0.05)); }
        .meta-live { width: 6px; height: 6px; background: #34d399; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; }
        .stat-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .stat-icon.blue { background: rgba(0,212,255,0.15); }
        .stat-icon.purple { background: rgba(124,58,237,0.15); }
        .stat-icon.green { background: rgba(16,185,129,0.15); }
        .stat-icon.orange { background: rgba(255,107,53,0.15); }
        .stat-value { font-size: 22px; font-weight: 700; font-family: 'Space Mono', monospace; color: var(--accent-blue); }
        .stat-label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; }
        .controls { display: flex; gap: 16px; margin-bottom: 20px; align-items: center; flex-wrap: wrap; }
        .search-box { flex: 1; max-width: 350px; position: relative; }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); font-size: 14px; color: var(--text-secondary); }
        .search-input { width: 100%; padding: 12px 14px 12px 42px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-size: 13px; }
        .search-input:focus { outline: none; border-color: var(--accent-blue); }
        .filter-btns { display: flex; gap: 8px; flex-wrap: wrap; }
        .filter-btn { padding: 10px 16px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-secondary); font-size: 12px; cursor: pointer; }
        .filter-btn.active { background: rgba(0,212,255,0.15); border-color: var(--accent-blue); color: var(--accent-blue); }
        .segment-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 16px; margin-bottom: 100px; }
        .parent-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 14px; overflow: hidden; animation: fadeIn 0.3s ease; }
        .parent-card.has-selected { border-color: var(--accent-green); box-shadow: 0 0 0 1px var(--accent-green); }
        .parent-header { padding: 16px 18px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; border-bottom: 1px solid transparent; }
        .parent-card.expanded .parent-header { border-bottom-color: var(--border-color); }
        .parent-left { display: flex; align-items: center; gap: 12px; }
        .parent-icon { width: 42px; height: 42px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; background: rgba(255,255,255,0.05); }
        .parent-name { font-size: 14px; font-weight: 600; }
        .parent-count { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }
        .parent-actions { display: flex; align-items: center; gap: 10px; }
        .select-all-btn { padding: 6px 12px; background: transparent; border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-secondary); font-size: 10px; cursor: pointer; }
        .expand-icon { color: var(--text-secondary); font-size: 12px; transition: transform 0.3s; }
        .parent-card.expanded .expand-icon { transform: rotate(180deg); }
        .sub-segments { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .parent-card.expanded .sub-segments { max-height: 800px; }
        .sub-segment { padding: 12px 18px; display: flex; align-items: center; gap: 12px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .sub-segment:last-child { border-bottom: none; }
        .sub-segment:hover { background: rgba(0,212,255,0.05); }
        .sub-segment.selected { background: rgba(16,185,129,0.1); }
        .checkbox { width: 20px; height: 20px; border: 2px solid var(--border-color); border-radius: 5px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .checkbox.checked { background: var(--accent-green); border-color: var(--accent-green); }
        .checkbox.checked::after { content: '‚úì'; color: white; font-size: 12px; font-weight: bold; }
        .sub-info { flex: 1; }
        .sub-name { font-size: 13px; font-weight: 500; }
        .sub-desc { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }
        .sub-meta { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
        .meta-tag { padding: 4px 8px; background: rgba(0,212,255,0.1); border-radius: 6px; font-size: 10px; color: var(--accent-blue); font-family: 'Space Mono', monospace; }
        .footer-actions { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(18,18,26,0.95); backdrop-filter: blur(20px); border-top: 1px solid var(--border-color); padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; transform: translateY(100%); transition: transform 0.3s ease; z-index: 100; }
        .footer-actions.visible { transform: translateY(0); }
        .footer-left { display: flex; align-items: center; gap: 16px; }
        .footer-count { font-size: 14px; color: var(--text-secondary); }
        .footer-count strong { color: var(--accent-blue); font-family: 'Space Mono', monospace; }
        .selected-chips { display: flex; gap: 8px; flex-wrap: wrap; }
        .selected-chip { padding: 6px 12px; background: rgba(16,185,129,0.15); border: 1px solid rgba(16,185,129,0.3); border-radius: 20px; font-size: 11px; color: var(--accent-green); display: flex; align-items: center; gap: 6px; }
        .chip-remove { cursor: pointer; opacity: 0.7; }
        .footer-right { display: flex; gap: 12px; }
        .btn { padding: 12px 20px; border: none; border-radius: 10px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-secondary { background: var(--bg-card); border: 1px solid var(--border-color); color: var(--text-primary); }
        .btn-primary { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); color: white; }
        .empty-state { grid-column: 1 / -1; text-align: center; padding: 60px 20px; }
        .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
        @media (max-width: 1200px) { .steps { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .steps { grid-template-columns: 1fr; } .quick-actions { grid-template-columns: 1fr; } .stats-row { grid-template-columns: repeat(2, 1fr); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        
        /* === UI/UX PRO MAX ENHANCEMENTS === */
        
        /* Cursor pointer for all interactive elements */
        button, a, [onclick], [role="button"], .clickable, .quick-action, .parent-header, .sub-segment, .segment-item, .filter-btn, .nav-link, .btn, .onboarding-dismiss, .onboarding-toggle, .select-all-btn, .chip-remove, .suggestion-btn, .meta-btn { cursor: pointer; }
        
        /* Smooth transitions */
        button, a, input, .card, .btn, .nav-link, .filter-btn, .quick-action, .parent-card, .parent-header, .sub-segment, .segment-item, .stat-card, .suggestion-item { transition: all 0.2s ease-out; }
        
        /* Focus states for keyboard navigation */
        :focus { outline: none; }
        :focus-visible { outline: 2px solid var(--accent-blue); outline-offset: 2px; }
        button:focus-visible, a:focus-visible, input:focus-visible { box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.25); }
        
        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
            .bg-grid { display: none; }
        }
        
        /* Prevent text selection on UI elements */
        button, .btn, .nav-link, .filter-btn, .quick-action, .segment-item, .stat-card { user-select: none; -webkit-user-select: none; }
        
        /* Better scrollbar */
        * { scrollbar-width: thin; scrollbar-color: var(--border-color) var(--bg-secondary); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
        
        /* Screen reader only */
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }
        
        /* Improved hover states */
        .quick-action:hover, .nav-link:hover, .filter-btn:hover, .parent-header:hover, .segment-item:hover, .sub-segment:hover { transform: translateY(-1px); }
        .btn:hover, .meta-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }
        .quick-action:active, .btn:active, .nav-link:active, .filter-btn:active { transform: translateY(0); }
        
        /* Card hover enhancement */
        .parent-card:hover, .stat-card:hover { border-color: rgba(0, 212, 255, 0.3); box-shadow: 0 0 20px rgba(0, 212, 255, 0.08); }
        
        /* Icon base styles */
        .icon { display: inline-flex; align-items: center; justify-content: center; width: 1em; height: 1em; }
        .icon svg { width: 100%; height: 100%; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

        
        /* === TOAST NOTIFICATION SYSTEM === */
        .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 10000; display: flex; flex-direction: column; gap: 12px; pointer-events: none; }
        .toast { pointer-events: auto; padding: 14px 20px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; display: flex; align-items: center; gap: 12px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4); transform: translateX(120%); opacity: 0; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); max-width: 380px; }
        .toast.visible { transform: translateX(0); opacity: 1; }
        .toast.hiding { transform: translateX(120%); opacity: 0; }
        .toast-success { border-left: 4px solid var(--accent-green); }
        .toast-error { border-left: 4px solid #ef4444; }
        .toast-info { border-left: 4px solid var(--accent-blue); }
        .toast-warning { border-left: 4px solid var(--accent-yellow); }
        .toast-icon { width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .toast-success .toast-icon { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }
        .toast-error .toast-icon { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .toast-info .toast-icon { background: rgba(0, 212, 255, 0.2); color: var(--accent-blue); }
        .toast-warning .toast-icon { background: rgba(245, 158, 11, 0.2); color: var(--accent-yellow); }
        .toast-content { flex: 1; }
        .toast-title { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
        .toast-message { font-size: 12px; color: var(--text-secondary); }
        .toast-close { background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px; border-radius: 4px; transition: all 0.2s; }
        .toast-close:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }
        .toast-progress { position: absolute; bottom: 0; left: 0; height: 3px; background: var(--accent-green); border-radius: 0 0 0 12px; animation: toast-progress linear forwards; }
        .toast-error .toast-progress { background: #ef4444; }
        .toast-info .toast-progress { background: var(--accent-blue); }
        .toast-warning .toast-progress { background: var(--accent-yellow); }
        @keyframes toast-progress { from { width: 100%; } to { width: 0%; } }
        
        /* === LOADING BUTTON STATES === */
        .btn-loading { position: relative; pointer-events: none; opacity: 0.7; }
        .btn-loading .btn-text { opacity: 0; }
        .btn-loading .btn-spinner { display: flex; }
        .btn-spinner { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .btn-spinner svg { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        button:disabled, .btn:disabled { opacity: 0.6; cursor: not-allowed; pointer-events: none; }
        .btn-content { display: flex; align-items: center; gap: 6px; }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 56 56" fill="none">
                        <!-- Rings -->
                        <circle class="globe-outer" cx="28" cy="28" r="25" stroke="url(#atlasGrad)" stroke-width="1.5" fill="none"/>
                        <circle class="globe-mid" cx="28" cy="28" r="17" stroke="url(#atlasGrad)" stroke-width="1" fill="none" opacity="0.7"/>
                        <circle class="globe-inner" cx="28" cy="28" r="10" stroke="url(#atlasGrad)" stroke-width="1" fill="none" opacity="0.5"/>
                        <!-- Lat/Long -->
                        <ellipse class="globe-lat" cx="28" cy="28" rx="25" ry="9" stroke="url(#atlasGrad)" stroke-width="0.75" fill="none" opacity="0.4"/>
                        <ellipse class="globe-long" cx="28" cy="28" rx="9" ry="25" stroke="url(#atlasGrad)" stroke-width="0.75" fill="none" opacity="0.4"/>
                        <!-- Center -->
                        <circle class="globe-center" cx="28" cy="28" r="3" fill="url(#atlasGrad)"/>
                        <!-- Cardinal points -->
                        <g class="cardinal-points">
                            <circle class="cardinal-point" cx="28" cy="3" r="2.5" fill="#00d4ff"/>
                            <circle class="cardinal-point" cx="53" cy="28" r="2.5" fill="#7c3aed"/>
                            <circle class="cardinal-point" cx="28" cy="53" r="2.5" fill="#14b8a6"/>
                            <circle class="cardinal-point" cx="3" cy="28" r="2.5" fill="#00d4ff"/>
                        </g>
                        <!-- Segment points -->
                        <circle class="seg-1" cx="42" cy="12" r="1.5" fill="#ec4899"/>
                        <circle class="seg-2" cx="46" cy="38" r="1.5" fill="#f59e0b"/>
                        <circle class="seg-3" cx="14" cy="44" r="1.5" fill="#10b981"/>
                        <circle class="seg-4" cx="10" cy="18" r="1.5" fill="#8b5cf6"/>
                        <defs>
                            <linearGradient id="atlasGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#00d4ff"/>
                                <stop offset="50%" stop-color="#7c3aed"/>
                                <stop offset="100%" stop-color="#14b8a6"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="logo-text">
                    <span class="brand">A.T.L.A.S</span>
                    <span class="tagline">Audience Targeting & Layered Analysis System</span>
                    <div class="powered-by">
                        <span>powered by</span>
                        <svg viewBox="0 0 20 20" width="12" height="12"><circle cx="7" cy="10" r="5" fill="none" stroke="#E91E8C" stroke-width="1.5"/><circle cx="13" cy="10" r="5" fill="none" stroke="#7B2D8E" stroke-width="1.5"/></svg>
                        <span class="growity-name">Growity AI Studio</span>
                    </div>
                </div>
            </div>
            <nav class="header-nav">
                <a href="segmentation-quadrant.html" class="nav-link" aria-label="Quadrant Analizi"><span class="icon"><svg viewBox="0 0 24 24"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg></span> Quadrant</a>
                <a href="po-segmentasyon.html" class="nav-link po" aria-label="Petrol Ofisi Premium Market"><span class="icon"><svg viewBox="0 0 24 24"><path d="M3 22V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v17"/><path d="M14 10h1a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 6"/><path d="M3 22h14"/><path d="M7 10h4"/></svg></span> PO Premium</a>
                <a href="enerjisa-30yil.html" class="nav-link enerjisa" aria-label="Enerjisa 30. Yƒ±l"><span class="icon"><svg viewBox="0 0 24 24"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg></span> Enerjisa</a>
            </nav>
        </header>
        <button class="onboarding-toggle" id="onboardingToggle" onclick="toggleOnboarding()" aria-label="Kullanƒ±m Rehberini G√∂ster"><span class="icon"><svg viewBox="0 0 24 24"><path d="M12 16v-4"/><path d="M12 8h.01"/><circle cx="12" cy="12" r="10"/></svg></span> Kullanƒ±m Rehberini G√∂ster</button>
        <section class="onboarding" id="onboarding">
            <div class="onboarding-header">
                <div class="onboarding-title"><span class="icon"><svg viewBox="0 0 24 24"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/></svg></span> <span>Ho≈ü Geldiniz!</span> Segment se√ßimine ba≈ülayƒ±n</div>
                <button class="onboarding-dismiss" onclick="toggleOnboarding()">Gizle ‚úï</button>
            </div>
            <div class="steps">
                <div class="step active" id="step1"><div class="step-number">1</div><div class="step-check"><svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6 9 17l-5-5"/></svg></div><div class="step-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/><path d="M12 2v4"/><path d="M12 18v4"/><path d="M2 12h4"/><path d="M18 12h4"/></svg></div><div class="step-title">Hedef Belirleyin</div><div class="step-desc">Awareness, Consideration veya Conversion funnel'ƒ±ndan birini se√ßin</div></div>
                <div class="step" id="step2"><div class="step-number">2</div><div class="step-check"><svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6 9 17l-5-5"/></svg></div><div class="step-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="6" height="6" rx="1"/><path d="m5 8 1 1 2-2"/><path d="M13 6h8"/><path d="M13 10h5"/><rect x="3" y="13" width="6" height="6" rx="1"/><path d="M13 14h8"/><path d="M13 18h5"/></svg></div><div class="step-title">Segment Se√ßin</div><div class="step-desc">ƒ∞lgili kategorileri a√ßƒ±p hedef segmentleri i≈üaretleyin</div></div>
                <div class="step" id="step3"><div class="step-number">3</div><div class="step-check"><svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6 9 17l-5-5"/></svg></div><div class="step-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><circle cx="9" cy="9" r="2"/><circle cx="17" cy="7" r="2"/><circle cx="13" cy="15" r="2"/></svg></div><div class="step-title">Analiz Edin</div><div class="step-desc">Se√ßimleri Quadrant'a g√∂ndererek g√∂rselle≈ütirin</div></div>
                <div class="step" id="step4"><div class="step-number">4</div><div class="step-check"><svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6 9 17l-5-5"/></svg></div><div class="step-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></svg></div><div class="step-title">Dƒ±≈üa Aktarƒ±n</div><div class="step-desc">CSV veya PNG olarak planlama ekibinizle payla≈üƒ±n</div></div>
            </div>
        </section>
        <section class="quick-actions">
            <div class="quick-action" onclick="selectFunnel('awareness')" id="funnel-awareness" role="button" tabindex="0" aria-label="Awareness segmentlerini se√ß"><div class="quick-action-icon awareness"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#7c3aed" stroke-width="2"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg></div><div class="quick-action-title">Awareness</div><div class="quick-action-count">18 segment otomatik se√ß</div></div>
            <div class="quick-action" onclick="selectFunnel('consideration')" id="funnel-consideration" role="button" tabindex="0" aria-label="Consideration segmentlerini se√ß"><div class="quick-action-icon consideration"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#f59e0b" stroke-width="2"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M12 5v13"/></svg></div><div class="quick-action-title">Consideration</div><div class="quick-action-count">20 segment otomatik se√ß</div></div>
            <div class="quick-action" onclick="selectFunnel('conversion')" id="funnel-conversion" role="button" tabindex="0" aria-label="Conversion segmentlerini se√ß"><div class="quick-action-icon conversion"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#10b981" stroke-width="2"><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg></div><div class="quick-action-title">Conversion</div><div class="quick-action-count">16 segment otomatik se√ß</div></div>
        </section>
        <div class="meta-panel">
            <div class="meta-panel-header">
                <div class="meta-panel-title"><span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg></span> Meta Audience Data <span class="meta-status" id="metaStatus">Hazƒ±r</span></div>
                <div class="meta-controls">
                    <input type="text" id="interestSearch" class="meta-input" placeholder="Interest ara (√∂r: travel)...">
                    <button class="meta-btn" onclick="searchInterest()" aria-label="Interest Ara"><span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg></span> Ara</button>
                    <button class="meta-btn purple" onclick="showMappingsModal()" aria-label="E≈üle≈ütirmeleri G√∂r√ºnt√ºle"><span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg></span> E≈üle≈ütirmeler</button>
                    <span class="meta-count" id="metaLoadedCount">0 e≈üle≈üme</span>
                </div>
            </div>
            <div id="interestResults"></div>
            <div class="ai-suggestions" id="aiSuggestions">
                <div class="ai-suggestions-header">
                    <div class="ai-suggestions-title">ü§ñ Akƒ±llƒ± Interest √ñnerileri <span id="suggestionCount" style="font-weight:400;color:var(--text-secondary);"></span></div>
                    <div class="ai-suggestions-actions">
                        <button class="meta-btn green" onclick="acceptAllSuggestions()">‚úì T√ºm√ºn√º Kabul</button>
                        <button class="meta-btn" onclick="fetchAllSuggestions()">üîÑ Yeniden √ñner</button>
                        <button class="suggestion-btn skip" onclick="closeSuggestions()">‚úï Kapat</button>
                    </div>
                </div>
                <div class="suggestions-list" id="suggestionsList"></div>
            </div>
        </div>
        <div class="stats-row">
            <div class="stat-card"><div class="stat-icon blue">üë•</div><div><div class="stat-value">68</div><div class="stat-label">Toplam Segment</div></div></div>
            <div class="stat-card"><div class="stat-icon purple">üìÅ</div><div><div class="stat-value">16</div><div class="stat-label">Ana Kategori</div></div></div>
            <div class="stat-card"><div class="stat-icon green">‚úì</div><div><div class="stat-value" id="selectedCount">0</div><div class="stat-label">Se√ßili</div></div></div>
            <div class="stat-card"><div class="stat-icon orange">üìà</div><div><div class="stat-value" id="totalReach">0%</div><div class="stat-label">Tahmini Reach</div></div></div>
        </div>
        <div class="controls">
            <div class="search-box"><span class="search-icon">üîç</span><input type="text" class="search-input" placeholder="Segment ara..." id="searchInput"></div>
            <div class="filter-btns">
                <button class="filter-btn active" data-filter="all">T√ºm√º</button>
                <button class="filter-btn" data-filter="lifestyle">üåü Lifestyle</button>
                <button class="filter-btn" data-filter="demografik">üë§ Demografik</button>
                <button class="filter-btn" data-filter="davranis">üõí Davranƒ±≈ü</button>
                <button class="filter-btn" data-filter="b2c">‚ö° B2C</button>
                <button class="filter-btn" data-filter="b2b">üè¢ B2B</button>
            </div>
        </div>
        <div class="segment-grid" id="segmentGrid"></div>
    </div>
    <div class="footer-actions" id="footerActions">
        <div class="footer-left"><span class="footer-count"><strong id="footerCount">0</strong> segment se√ßildi</span><div class="selected-chips" id="selectedChips"></div></div>
        <div class="footer-right">
            <button class="btn btn-secondary" onclick="clearSelection()">Temizle</button>
            <button class="btn btn-secondary" onclick="exportSelection()">üì• CSV</button>
            <button class="btn btn-primary" onclick="goToQuadrant()">Quadrant'a G√∂nder ‚Üí</button>
        </div>
    </div>
    <script>
const segments = [
    { id: 'yasam-tarzi', name: 'Ya≈üam Tarzƒ± Segmentleri', icon: 'üåü', category: 'lifestyle', subs: [
        { id: 'yt-1', name: 'Trendsetter √ñnc√ºler', desc: 'Yeniliklere a√ßƒ±k, trendleri belirleyen', reach: 8.2 },
        { id: 'yt-2', name: 'Stat√º Odaklƒ± Profesyoneller', desc: 'Kariyer ve sosyal stat√º √∂ncelikli', reach: 12.5 },
        { id: 'yt-3', name: 'Deneyim Avcƒ±larƒ±', desc: 'Yeni deneyimler arayan maceraperestler', reach: 9.8 },
        { id: 'yt-4', name: 'Wellness Tutkunlarƒ±', desc: 'Saƒülƒ±k ve wellness odaklƒ±', reach: 7.3 }
    ]},
    { id: 'tuketim', name: 'T√ºketim Alƒ±≈ükanlƒ±klarƒ±', icon: 'üõí', category: 'davranis', subs: [
        { id: 'tk-1', name: 'Premium T√ºketiciler', desc: 'Kaliteyi fiyatƒ±n √∂n√ºnde tutan', reach: 11.2 },
        { id: 'tk-2', name: 'Deƒüer Arayanlar', desc: 'Fiyat-performans pe≈üinde', reach: 18.7 },
        { id: 'tk-3', name: 'D√ºrt√ºsel Alƒ±≈üveri≈ü√ßiler', desc: 'Anlƒ±k kararlarla alƒ±≈üveri≈ü', reach: 14.3 },
        { id: 'tk-4', name: 'Planlƒ± Alƒ±≈üveri≈ü√ßiler', desc: 'Her ≈üeyi √∂nceden planlayan', reach: 15.8 }
    ]},
    { id: 'dijital', name: 'Dijital Davranƒ±≈ü', icon: 'üì±', category: 'davranis', subs: [
        { id: 'dj-1', name: 'Dijital Yerliler', desc: 'Hayatƒ± dijitalde ya≈üayan', reach: 22.4 },
        { id: 'dj-2', name: 'Sosyal Medya Aktifi', desc: 'T√ºm platformlarda aktif', reach: 28.6 },
        { id: 'dj-3', name: 'E-Ticaret Uzmanƒ±', desc: 'Online alƒ±≈üveri≈üi tercih eden', reach: 19.2 },
        { id: 'dj-4', name: 'Dijital Temkinli', desc: 'Teknolojiyle mesafeli', reach: 12.1 }
    ]},
    { id: 'aile', name: 'Aile Ya≈üamƒ±', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', category: 'demografik', subs: [
        { id: 'al-1', name: 'Gen√ß Aileler', desc: 'K√º√ß√ºk √ßocuklu aileler', reach: 16.8 },
        { id: 'al-2', name: 'B√ºy√ºyen Aileler', desc: 'Okul √ßaƒüƒ± √ßocuklu', reach: 14.2 },
        { id: 'al-3', name: 'Bo≈ü Yuva', desc: '√áocuklar evden ayrƒ±lmƒ±≈ü', reach: 9.5 },
        { id: 'al-4', name: 'Tekli Ya≈üayanlar', desc: 'Yalnƒ±z ya≈üayan yeti≈ükinler', reach: 11.3 }
    ]},
    { id: 'gelir', name: 'Gelir Segmentleri', icon: 'üí∞', category: 'demografik', subs: [
        { id: 'gl-1', name: '√úst Gelir A+', desc: 'En y√ºksek gelir grubu', reach: 5.2 },
        { id: 'gl-2', name: '√úst-Orta A', desc: 'Y√ºksek gelir grubu', reach: 12.8 },
        { id: 'gl-3', name: 'Orta B', desc: 'Orta gelir grubu', reach: 35.4 },
        { id: 'gl-4', name: 'Alt-Orta C', desc: 'Alt-orta gelir grubu', reach: 28.6 }
    ]},
    { id: 'medya', name: 'Medya T√ºketimi', icon: 'üì∫', category: 'davranis', subs: [
        { id: 'md-1', name: 'TV Aƒüƒ±rlƒ±klƒ±', desc: 'Geleneksel TV izleyicisi', reach: 42.3 },
        { id: 'md-2', name: 'Streaming Odaklƒ±', desc: 'Dijital i√ßerik tercih eden', reach: 31.5 },
        { id: 'md-3', name: 'Multi-Screen', desc: '√áoklu ekran kullanƒ±cƒ±sƒ±', reach: 38.7 },
        { id: 'md-4', name: 'Radyo Dinleyicisi', desc: 'Aktif radyo takip√ßisi', reach: 24.8 }
    ]},
    { id: 'otomobil', name: 'Otomobil Segmentleri', icon: 'üöó', category: 'davranis', subs: [
        { id: 'ot-1', name: 'Premium Ara√ß Sahipleri', desc: 'L√ºks segment ara√ß', reach: 8.4 },
        { id: 'ot-2', name: 'SUV Tutkunlarƒ±', desc: 'SUV/crossover tercihi', reach: 15.2 },
        { id: 'ot-3', name: 'Ekonomik S√ºr√ºc√ºler', desc: 'Yakƒ±t tasarrufu odaklƒ±', reach: 22.6 },
        { id: 'ot-4', name: 'Elektrik/Hibrit ƒ∞lgili', desc: 'Alternatif yakƒ±t meraklƒ±larƒ±', reach: 6.8 }
    ]},
    { id: 'seyahat', name: 'Seyahat Tercihleri', icon: '‚úàÔ∏è', category: 'lifestyle', subs: [
        { id: 'sy-1', name: 'Sƒ±k Seyahat Edenler', desc: 'Yƒ±lda 4+ seyahat', reach: 12.4 },
        { id: 'sy-2', name: 'Tatil Planlayƒ±cƒ±larƒ±', desc: 'Yƒ±llƒ±k tatil odaklƒ±', reach: 28.6 },
        { id: 'sy-3', name: 'ƒ∞≈ü Seyahati Yapanlar', desc: 'Profesyonel seyahat', reach: 9.8 },
        { id: 'sy-4', name: 'Yerel Gezginler', desc: 'Yurt i√ßi ke≈üif seven', reach: 18.2 }
    ]},
    { id: 'finans', name: 'Finansal Davranƒ±≈ü', icon: 'üí≥', category: 'davranis', subs: [
        { id: 'fn-1', name: 'Yatƒ±rƒ±mcƒ±lar', desc: 'Aktif yatƒ±rƒ±m yapan', reach: 14.6 },
        { id: 'fn-2', name: 'Tasarruf Odaklƒ±', desc: 'Birikim √∂ncelikli', reach: 22.8 },
        { id: 'fn-3', name: 'Kredi Kullanƒ±cƒ±larƒ±', desc: 'Aktif kredi kullanan', reach: 31.4 },
        { id: 'fn-4', name: 'Dijital Bankacƒ±lƒ±k', desc: 'Mobile banking aktif', reach: 45.2 }
    ]},
    { id: 'beslenme', name: 'Beslenme Tercihleri', icon: 'üçΩÔ∏è', category: 'lifestyle', subs: [
        { id: 'bs-1', name: 'Saƒülƒ±klƒ± Beslenme', desc: 'Organik ve doƒüal tercih', reach: 18.4 },
        { id: 'bs-2', name: 'Fast Food Severler', desc: 'Hƒ±zlƒ± yemek tercihi', reach: 24.6 },
        { id: 'bs-3', name: 'Gurme Tutkunlarƒ±', desc: 'Kaliteli restoran seven', reach: 11.2 },
        { id: 'bs-4', name: 'Ev Yemekleri', desc: 'Evde pi≈üirmeyi tercih', reach: 32.8 }
    ]},
    { id: 'influencers', name: 'Influencers (Etkileyiciler)', icon: '‚ö°', category: 'b2c', subs: [
        { id: 'inf-1', name: 'Hane Halklarƒ± - Kesintisiz Enerji', desc: 'G√ºvenilir elektrik bekleyen', reach: 42.5 },
        { id: 'inf-2', name: 'Hane Halklarƒ± - Dijital M√º≈üteri', desc: 'Online i≈ülem isteyen', reach: 28.3 },
        { id: 'inf-3', name: 'Mobil Kullanƒ±cƒ±lar', desc: 'Uygulama √ºzerinden i≈ülem', reach: 35.6 },
        { id: 'inf-4', name: 'K√º√ß√ºk ƒ∞≈ületmeler', desc: 'Enerji optimizasyonu arayan KOBƒ∞', reach: 12.8 },
        { id: 'inf-5', name: 'Enerjisa √áalƒ±≈üanlarƒ±', desc: 'ƒ∞√ß payda≈ülar', reach: 1.2 },
        { id: 'inf-6', name: 'G√ºven Odaklƒ± T√ºketiciler', desc: '≈ûeffaf ileti≈üim bekleyen', reach: 38.4 },
        { id: 'inf-7', name: 'Sosyal Medya Takip√ßileri', desc: 'Dijital kanallarda aktif', reach: 48.2 },
        { id: 'inf-8', name: 'Fiyat Odaklƒ± T√ºketiciler', desc: 'Maliyet hassasiyeti y√ºksek', reach: 52.1 }
    ]},
    { id: 'gatekeeper', name: 'Gatekeepers', icon: 'üèõÔ∏è', category: 'b2b', subs: [
        { id: 'gk-1', name: 'Yerel Y√∂netimler', desc: 'Belediyeler ve il idareleri', reach: 2.4 },
        { id: 'gk-2', name: 'Muhtarlar', desc: 'Mahalle toplum liderleri', reach: 4.8 },
        { id: 'gk-3', name: 'STK ve Sivil Toplum', desc: 'S√ºrd√ºr√ºlebilirlik odaklƒ±', reach: 1.6 },
        { id: 'gk-4', name: 'Akademik Kurumlar', desc: '√úniversiteler', reach: 0.8 },
        { id: 'gk-5', name: 'S√ºrd√ºr√ºlebilirlik Partnerleri', desc: 'Ye≈üil enerji ortaklarƒ±', reach: 1.2 },
        { id: 'gk-6', name: 'Medya Kurulu≈ülarƒ±', desc: 'Gazeteciler', reach: 3.5 },
        { id: 'gk-7', name: 'Enerji Sekt√∂r√º Analistleri', desc: 'Sekt√∂r uzmanlarƒ±', reach: 0.5 },
        { id: 'gk-8', name: 'Yerel Ticaret Odalarƒ±', desc: 'B√∂lgesel i≈ü temsilcileri', reach: 2.1 },
        { id: 'gk-9', name: 'T√ºketici Dernekleri', desc: 'T√ºketici haklarƒ±', reach: 1.8 },
        { id: 'gk-10', name: '√áevre Aktivistleri', desc: 'ƒ∞klim odaklƒ± gruplar', reach: 2.2 }
    ]},
    { id: 'decisionmaker', name: 'Decision Makers', icon: 'üéØ', category: 'b2b', subs: [
        { id: 'dm-1', name: 'Devlet Kurumlarƒ±', desc: 'EPDK, Enerji Bakanlƒ±ƒüƒ±', reach: 0.3 },
        { id: 'dm-2', name: 'Reg√ºlat√∂rler (EPDK)', desc: 'D√ºzenleyici kurumlar', reach: 0.2 },
        { id: 'dm-3', name: 'Kurumsal Yatƒ±rƒ±mcƒ±lar', desc: 'ESG odaklƒ± fonlar', reach: 0.8 },
        { id: 'dm-4', name: 'Bireysel Yatƒ±rƒ±mcƒ±lar', desc: 'Hisse takip√ßileri', reach: 3.5 },
        { id: 'dm-5', name: 'Stratejik ƒ∞≈ü Ortaklarƒ±', desc: 'Uzun vadeli ortaklƒ±k', reach: 1.4 },
        { id: 'dm-6', name: 'Finans Kurulu≈ülarƒ±', desc: 'Bankalar', reach: 0.6 },
        { id: 'dm-7', name: 'Uluslararasƒ± Enerji Fonlarƒ±', desc: 'Global ESG fonlarƒ±', reach: 0.4 },
        { id: 'dm-8', name: 'Borsa Analistleri', desc: 'Equity research', reach: 0.7 },
        { id: 'dm-9', name: 'Finans Medyasƒ±', desc: 'Bloomberg, Reuters', reach: 1.2 },
        { id: 'dm-10', name: 'Perakende Yatƒ±rƒ±mcƒ± Topluluklarƒ±', desc: 'Online forumlar', reach: 4.8 }
    ]}
];

const INTEREST_RECOMMENDATIONS = {
    // Ya≈üam Tarzƒ± Segmentleri
    'yt-1': { keyword: 'early adopter technology', name: 'Technology early adopters' },
    'yt-2': { keyword: 'business executive', name: 'Business and industry' },
    'yt-3': { keyword: 'adventure', name: 'Outdoor recreation' },
    'yt-4': { keyword: 'fitness wellness', name: 'Physical fitness' },
    
    // T√ºketim Alƒ±≈ükanlƒ±klarƒ±
    'tk-1': { keyword: 'luxury shopping', name: 'Luxury goods' },
    'tk-2': { keyword: 'online shopping', name: 'Online shopping' },
    'tk-3': { keyword: 'shopping fashion', name: 'Shopping and fashion' },
    'tk-4': { keyword: 'personal finance', name: 'Personal finance' },
    
    // Dijital Davranƒ±≈ü
    'dj-1': { keyword: 'technology', name: 'Consumer electronics' },
    'dj-2': { keyword: 'social media', name: 'Social media' },
    'dj-3': { keyword: 'online shopping', name: 'Online shopping' },
    'dj-4': { keyword: 'television', name: 'Television' },
    
    // Aile Ya≈üamƒ±
    'al-1': { keyword: 'parenting', name: 'Family and relationships' },
    'al-2': { keyword: 'family activities', name: 'Family' },
    'al-3': { keyword: 'travel leisure', name: 'Travel' },
    'al-4': { keyword: 'entertainment', name: 'Entertainment' },
    
    // Gelir Segmentleri
    'gl-1': { keyword: 'luxury', name: 'Luxury goods' },
    'gl-2': { keyword: 'investment', name: 'Investing' },
    'gl-3': { keyword: 'shopping', name: 'Shopping and fashion' },
    'gl-4': { keyword: 'discount', name: 'Coupons' },
    
    // Medya T√ºketimi
    'md-1': { keyword: 'television', name: 'Television' },
    'md-2': { keyword: 'streaming entertainment', name: 'Entertainment' },
    'md-3': { keyword: 'smartphone', name: 'Smartphones' },
    'md-4': { keyword: 'music', name: 'Music' },
    
    // Otomobil Segmentleri
    'ot-1': { keyword: 'luxury vehicles', name: 'Automobiles' },
    'ot-2': { keyword: 'SUV cars', name: 'SUVs' },
    'ot-3': { keyword: 'automotive', name: 'Automotive industry' },
    'ot-4': { keyword: 'electric car', name: 'Electric vehicle' },
    
    // Seyahat Tercihleri
    'sy-1': { keyword: 'frequent traveler', name: 'Air travel' },
    'sy-2': { keyword: 'vacation travel', name: 'Tourism' },
    'sy-3': { keyword: 'business travel', name: 'Business travel' },
    'sy-4': { keyword: 'domestic tourism', name: 'Tourism' },
    
    // Finansal Davranƒ±≈ü
    'fn-1': { keyword: 'investing finance', name: 'Investing' },
    'fn-2': { keyword: 'personal finance', name: 'Personal finance' },
    'fn-3': { keyword: 'credit card', name: 'Credit cards' },
    'fn-4': { keyword: 'mobile banking', name: 'Online banking' },
    
    // Beslenme Tercihleri
    'bs-1': { keyword: 'healthy food', name: 'Organic food' },
    'bs-2': { keyword: 'fast food restaurants', name: 'Fast food restaurants' },
    'bs-3': { keyword: 'restaurants dining', name: 'Restaurants' },
    'bs-4': { keyword: 'cooking recipes', name: 'Cooking' },
    
    // Influencers (B2C)
    'inf-1': { keyword: 'home improvement', name: 'Home improvement' },
    'inf-2': { keyword: 'online services', name: 'Online shopping' },
    'inf-3': { keyword: 'smartphone apps', name: 'Smartphones' },
    'inf-4': { keyword: 'small business owner', name: 'Small business' },
    'inf-5': { keyword: 'corporate', name: 'Business and industry' },
    'inf-6': { keyword: 'customer experience', name: 'Online shopping' },
    'inf-7': { keyword: 'social media', name: 'Social media' },
    'inf-8': { keyword: 'bargain hunting', name: 'Coupons' },
    
    // Gatekeepers (B2B)
    'gk-1': { keyword: 'government', name: 'Politics and social issues' },
    'gk-2': { keyword: 'community local', name: 'Community' },
    'gk-3': { keyword: 'nonprofit charity', name: 'Charity and causes' },
    'gk-4': { keyword: 'higher education', name: 'Higher education' },
    'gk-5': { keyword: 'sustainability green', name: 'Environmentalism' },
    'gk-6': { keyword: 'news journalism', name: 'Journalism' },
    'gk-7': { keyword: 'energy industry', name: 'Energy industry' },
    'gk-8': { keyword: 'business networking', name: 'Business' },
    'gk-9': { keyword: 'consumer rights', name: 'Consumer awareness' },
    'gk-10': { keyword: 'environment climate', name: 'Environmentalism' },
    
    // Decision Makers (B2B)
    'dm-1': { keyword: 'government policy', name: 'Politics and social issues' },
    'dm-2': { keyword: 'regulation compliance', name: 'Business and industry' },
    'dm-3': { keyword: 'sustainable investing', name: 'Investing' },
    'dm-4': { keyword: 'stock market', name: 'Investing' },
    'dm-5': { keyword: 'b2b business', name: 'Business' },
    'dm-6': { keyword: 'banking finance', name: 'Banking' },
    'dm-7': { keyword: 'international business', name: 'Business' },
    'dm-8': { keyword: 'financial analysis', name: 'Finance' },
    'dm-9': { keyword: 'financial news', name: 'Business news' },
    'dm-10': { keyword: 'stock trading', name: 'Investing' }
};

let selectedSegments = new Set();
let activeFunnel = null;
let currentSuggestions = [];
let META_SEGMENT_MAP = {};
let metaDataCache = {};

const funnelSegments = {
    awareness: ['yt-1','yt-3','dj-2','dj-1','md-2','md-1','inf-1','inf-2','inf-6','inf-7','gk-1','gk-2','gk-3','gk-6','dm-3','dm-5','bs-1','sy-2'],
    consideration: ['yt-2','yt-4','tk-1','tk-2','dj-3','al-1','al-2','md-3','inf-3','inf-4','inf-8','gk-4','gk-5','gk-7','dm-4','dm-6','dm-8','fn-1','fn-4','ot-4'],
    conversion: ['tk-3','tk-4','dj-4','al-3','al-4','fn-2','fn-3','inf-5','gk-8','gk-9','gk-10','dm-1','dm-2','dm-7','dm-9','dm-10']
};

const META_CONFIG = { 
    accessToken: 'EAAYe5SrdjKgBQZAZAZCh5uE3KLAyOrABkdC5gZCZBcLwdzaAXOKAjGVP7puJt2IijGivXAtQZCd6tbPrkDSoK9JRfWZBHsq2CuqdkL4L33a0xWDbZAyQxuwSjA62eZB3GcZBB6FXWueGyExbs3zZApqbB5IlEZCOfMM1zPjqKYaQF1N2TYZCoAfEfbLgWJZBFz0tggiOnKRwZDZD', 
    adAccountId: '1449083392081509', 
    apiVersion: 'v18.0' 
};

function init() {
    renderSegments();
    setupEventListeners();
    checkOnboardingState();
    loadSavedMappings();
    updateMetaCount();
}

function setupEventListeners() {
    document.querySelectorAll('.filter-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.filter-btn').forEach(function(b) { b.classList.remove('active'); });
            btn.classList.add('active');
            renderSegments(btn.dataset.filter, document.getElementById('searchInput').value);
        });
    });
    
    // Debounced search - 300ms bekle sonra filtrele
    var searchInput = document.getElementById('searchInput');
    var debouncedSearch = debounce(function(value) {
        var activeFilter = document.querySelector('.filter-btn.active');
        renderSegments(activeFilter ? activeFilter.dataset.filter : 'all', value);
    }, 300);
    
    searchInput.addEventListener('input', function(e) {
        debouncedSearch(e.target.value);
    });
    
    document.getElementById('interestSearch').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') searchInterest();
    });
}

// === DEBOUNCE HELPER ===
function debounce(func, wait) {
    var timeout;
    return function() {
        var context = this, args = arguments;
        clearTimeout(timeout);
        timeout = setTimeout(function() {
            func.apply(context, args);
        }, wait);
    };
}

function checkOnboardingState() {
    if (localStorage.getItem('onboardingHidden') === 'true') {
        document.getElementById('onboarding').classList.add('hidden');
        document.getElementById('onboardingToggle').classList.add('visible');
    }
}

function toggleOnboarding() {
    var onboarding = document.getElementById('onboarding');
    var toggle = document.getElementById('onboardingToggle');
    if (onboarding.classList.contains('hidden')) {
        onboarding.classList.remove('hidden');
        toggle.classList.remove('visible');
        localStorage.setItem('onboardingHidden', 'false');
    } else {
        onboarding.classList.add('hidden');
        toggle.classList.add('visible');
        localStorage.setItem('onboardingHidden', 'true');
    }
}

function renderSegments(filter, search) {
    filter = filter || 'all';
    search = search || '';
    var grid = document.getElementById('segmentGrid');
    grid.innerHTML = '';
    
    var filtered = segments.filter(function(parent) {
        if (filter !== 'all' && parent.category !== filter) return false;
        if (search) {
            var s = search.toLowerCase();
            if (parent.name.toLowerCase().indexOf(s) !== -1) return true;
            for (var i = 0; i < parent.subs.length; i++) {
                if (parent.subs[i].name.toLowerCase().indexOf(s) !== -1) return true;
                if (parent.subs[i].desc.toLowerCase().indexOf(s) !== -1) return true;
            }
            return false;
        }
        return true;
    });
    
    if (filtered.length === 0) {
        grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><h3>Segment bulunamadƒ±</h3></div>';
        return;
    }
    
    filtered.forEach(function(parent, idx) {
        var selectedInParent = parent.subs.filter(function(s) { return selectedSegments.has(s.id); }).length;
        var hasSelected = selectedInParent > 0;
        var card = document.createElement('div');
        card.className = 'parent-card' + (hasSelected ? ' has-selected' : '');
        card.dataset.parent = parent.id;
        card.style.animationDelay = (idx * 0.05) + 's';
        
        var subsHtml = '';
        parent.subs.forEach(function(sub) {
            var mapping = META_SEGMENT_MAP[sub.id];
            var metaText = mapping ? mapping.interests[0].name : '--';
            var isSelected = selectedSegments.has(sub.id);
            subsHtml += '<div class="sub-segment' + (isSelected ? ' selected' : '') + '" onclick="toggleSegment(\'' + sub.id + '\')">' +
                '<div class="checkbox' + (isSelected ? ' checked' : '') + '"></div>' +
                '<div class="sub-info"><div class="sub-name">' + sub.name + '</div><div class="sub-desc">' + sub.desc + '</div></div>' +
                '<div class="sub-meta"><span class="meta-tag">' + sub.reach + '%</span>' +
                '<span class="meta-reach' + (mapping ? ' loaded' : '') + '" id="meta-' + sub.id + '">üìä ' + metaText + '</span></div></div>';
        });
        
        card.innerHTML = '<div class="parent-header" onclick="toggleParent(\'' + parent.id + '\')">' +
            '<div class="parent-left"><div class="parent-icon">' + parent.icon + '</div><div>' +
            '<div class="parent-name">' + parent.name + '</div>' +
            '<div class="parent-count">' + parent.subs.length + ' segment' + (selectedInParent > 0 ? ' ‚Ä¢ <span style="color:var(--accent-green)">' + selectedInParent + ' se√ßili</span>' : '') + '</div></div></div>' +
            '<div class="parent-actions"><button class="select-all-btn" onclick="event.stopPropagation();selectAllInParent(\'' + parent.id + '\')">' + 
            (selectedInParent === parent.subs.length ? 'Kaldƒ±r' : 'T√ºm√º') + '</button><span class="expand-icon">‚ñº</span></div></div>' +
            '<div class="sub-segments">' + subsHtml + '</div>';
        grid.appendChild(card);
    });
}

function toggleParent(parentId) {
    var card = document.querySelector('[data-parent="' + parentId + '"]');
    card.classList.toggle('expanded');
}

function toggleSegment(segmentId) {
    if (selectedSegments.has(segmentId)) {
        selectedSegments.delete(segmentId);
    } else {
        selectedSegments.add(segmentId);
    }
    updateUI();
    updateSteps();
}

function selectAllInParent(parentId) {
    var parent = segments.find(function(p) { return p.id === parentId; });
    var allSelected = parent.subs.every(function(s) { return selectedSegments.has(s.id); });
    parent.subs.forEach(function(sub) {
        if (allSelected) { selectedSegments.delete(sub.id); }
        else { selectedSegments.add(sub.id); }
    });
    updateUI();
    updateSteps();
}

function selectFunnel(funnel) {
    var btn = document.getElementById('funnel-' + funnel);
    var wasActive = btn.classList.contains('active');
    document.querySelectorAll('.quick-action').forEach(function(b) { b.classList.remove('active'); });
    
    if (wasActive) {
        activeFunnel = null;
        clearSelection();
        closeSuggestions();
    } else {
        btn.classList.add('active');
        activeFunnel = funnel;
        selectedSegments.clear();
        funnelSegments[funnel].forEach(function(segId) {
            if (findSegment(segId)) { selectedSegments.add(segId); }
        });
        updateUI();
        updateSteps();
        document.querySelectorAll('.parent-card').forEach(function(card) { card.classList.add('expanded'); });
        generateSuggestions();
        showToast(selectedSegments.size + ' ' + funnel.charAt(0).toUpperCase() + funnel.slice(1) + ' segmenti se√ßildi', 'info');
    }
}

function clearSelection() {
    selectedSegments.clear();
    activeFunnel = null;
    document.querySelectorAll('.quick-action').forEach(function(b) { b.classList.remove('active'); });
    updateUI();
    updateSteps();
    closeSuggestions();
    showToast('Se√ßim temizlendi', 'info');
}

function findSegment(segmentId) {
    for (var i = 0; i < segments.length; i++) {
        var sub = segments[i].subs.find(function(s) { return s.id === segmentId; });
        if (sub) return sub;
    }
    return null;
}

function updateUI() {
    document.getElementById('selectedCount').textContent = selectedSegments.size;
    document.getElementById('footerCount').textContent = selectedSegments.size;
    
    var totalReach = 0;
    segments.forEach(function(p) {
        p.subs.forEach(function(s) {
            if (selectedSegments.has(s.id)) totalReach += s.reach * 0.6;
        });
    });
    document.getElementById('totalReach').textContent = Math.min(totalReach, 95).toFixed(1) + '%';
    
    if (selectedSegments.size > 0) {
        document.getElementById('footerActions').classList.add('visible');
    } else {
        document.getElementById('footerActions').classList.remove('visible');
    }
    
    var chipsContainer = document.getElementById('selectedChips');
    chipsContainer.innerHTML = '';
    var count = 0;
    selectedSegments.forEach(function(segId) {
        if (count >= 4) return;
        var seg = findSegment(segId);
        if (seg) {
            var chip = document.createElement('span');
            chip.className = 'selected-chip';
            chip.innerHTML = seg.name + ' <span class="chip-remove" onclick="event.stopPropagation();toggleSegment(\'' + segId + '\')">√ó</span>';
            chipsContainer.appendChild(chip);
            count++;
        }
    });
    if (selectedSegments.size > 4) {
        var moreChip = document.createElement('span');
        moreChip.className = 'selected-chip';
        moreChip.textContent = '+' + (selectedSegments.size - 4) + ' daha';
        chipsContainer.appendChild(moreChip);
    }
    
    var activeFilter = document.querySelector('.filter-btn.active');
    renderSegments(activeFilter ? activeFilter.dataset.filter : 'all', document.getElementById('searchInput').value);
}

function updateSteps() {
    var step1 = document.getElementById('step1');
    var step2 = document.getElementById('step2');
    if (activeFunnel) { step1.classList.add('completed'); } else { step1.classList.remove('completed'); }
    if (selectedSegments.size > 0) {
        step2.classList.add('active');
        if (selectedSegments.size >= 3) { step2.classList.add('completed'); } else { step2.classList.remove('completed'); }
    } else {
        step2.classList.remove('active');
        step2.classList.remove('completed');
    }
}

// AI SUGGESTIONS
function generateSuggestions() {
    currentSuggestions = [];
    var panel = document.getElementById('aiSuggestions');
    
    selectedSegments.forEach(function(segId) {
        if (!META_SEGMENT_MAP[segId] && INTEREST_RECOMMENDATIONS[segId]) {
            var rec = INTEREST_RECOMMENDATIONS[segId];
            var segment = findSegment(segId);
            if (segment) {
                currentSuggestions.push({
                    segmentId: segId,
                    segmentName: segment.name,
                    keyword: rec.keyword,
                    suggestedName: rec.name,
                    status: 'pending',
                    selectedInterest: null,
                    audienceSize: null
                });
            }
        }
    });
    
    if (currentSuggestions.length > 0) {
        panel.classList.add('visible');
        document.getElementById('suggestionCount').textContent = '(' + currentSuggestions.length + ' segment i√ßin)';
        renderSuggestions();
        fetchAllSuggestions();
    } else {
        panel.classList.remove('visible');
    }
}

function renderSuggestions() {
    var list = document.getElementById('suggestionsList');
    var html = '';
    
    currentSuggestions.forEach(function(s, idx) {
        var statusHtml = '';
        var actionsHtml = '';
        
        if (s.status === 'loading') {
            statusHtml = '<span style="color:var(--accent-yellow)">‚è≥ Aranƒ±yor...</span>';
        } else if (s.status === 'accepted') {
            statusHtml = '<span class="suggestion-status">‚úì Kabul Edildi</span>';
        } else if (s.status === 'skipped') {
            statusHtml = '<span style="color:var(--text-secondary)">Atlandƒ±</span>';
        } else if (s.selectedInterest) {
            var sizeText = s.audienceSize ? ' (' + formatMetaNumber(s.audienceSize) + ')' : '';
            statusHtml = '<span class="suggestion-interest">' + s.selectedInterest.name + '</span><span class="suggestion-size">' + sizeText + '</span>';
            actionsHtml = '<button class="suggestion-btn accept" onclick="acceptSuggestion(' + idx + ')">‚úì Kabul</button><button class="suggestion-btn skip" onclick="skipSuggestion(' + idx + ')">Atla</button>';
        } else {
            statusHtml = '<span style="color:var(--text-secondary)">Bekleniyor...</span>';
        }
        
        html += '<div class="suggestion-item' + (s.status === 'accepted' ? ' accepted' : '') + (s.status === 'loading' ? ' loading' : '') + '">' +
            '<div class="suggestion-left"><span class="suggestion-segment">' + s.segmentName + '</span>' +
            '<span class="suggestion-arrow">‚Üí</span>' + statusHtml + '</div>' +
            '<div class="suggestion-actions">' + actionsHtml + '</div></div>';
    });
    
    list.innerHTML = html;
}

function fetchAllSuggestions() {
    updateMetaStatus('loading', '√ñneriler hazƒ±rlanƒ±yor...');
    
    var promises = currentSuggestions.map(function(s, idx) {
        if (s.status !== 'pending') return Promise.resolve();
        
        s.status = 'loading';
        renderSuggestions();
        
        return new Promise(function(resolve) {
            setTimeout(function() {
                var url = 'https://graph.facebook.com/' + META_CONFIG.apiVersion + '/search?type=adinterest&q=' + encodeURIComponent(s.keyword) + '&limit=1&access_token=' + META_CONFIG.accessToken;
                
                fetch(url)
                    .then(function(res) { return res.json(); })
                    .then(function(data) {
                        if (data.data && data.data.length > 0) {
                            var interest = data.data[0];
                            s.selectedInterest = { id: interest.id, name: interest.name };
                            
                            return getMetaReachEstimate([{ id: interest.id, name: interest.name }])
                                .then(function(sizeData) {
                                    s.audienceSize = sizeData.users_upper_bound;
                                })
                                .catch(function() {
                                    s.audienceSize = null;
                                });
                        }
                    })
                    .then(function() {
                        s.status = 'ready';
                        renderSuggestions();
                        resolve();
                    })
                    .catch(function(err) {
                        console.error('Error:', err);
                        s.status = 'error';
                        renderSuggestions();
                        resolve();
                    });
            }, idx * 400);
        });
    });
    
    Promise.all(promises).then(function() {
        updateMetaStatus('connected', '‚úì √ñneriler hazƒ±r');
    });
}

function acceptSuggestion(idx) {
    var s = currentSuggestions[idx];
    if (s.selectedInterest) {
        META_SEGMENT_MAP[s.segmentId] = {
            name: s.segmentName,
            interests: [s.selectedInterest]
        };
        if (s.audienceSize) {
            metaDataCache[s.segmentId] = { formatted: formatMetaNumber(s.audienceSize) };
        }
        s.status = 'accepted';
        saveMappings();
        updateMetaCount();
        renderSuggestions();
        renderSegments();
        showToast(s.segmentName + ' ‚Üí ' + s.selectedInterest.name, 'success');
    }
}

function skipSuggestion(idx) {
    currentSuggestions[idx].status = 'skipped';
    renderSuggestions();
}

function acceptAllSuggestions() {
    var accepted = 0;
    currentSuggestions.forEach(function(s, idx) {
        if (s.status === 'ready' && s.selectedInterest) {
            META_SEGMENT_MAP[s.segmentId] = {
                name: s.segmentName,
                interests: [s.selectedInterest]
            };
            if (s.audienceSize) {
                metaDataCache[s.segmentId] = { formatted: formatMetaNumber(s.audienceSize) };
            }
            s.status = 'accepted';
            accepted++;
        }
    });
    saveMappings();
    updateMetaCount();
    renderSuggestions();
    renderSegments();
    showToast(accepted + ' √∂neri kabul edildi', 'success');
}

function closeSuggestions() {
    document.getElementById('aiSuggestions').classList.remove('visible');
    currentSuggestions = [];
}

// META API
function formatMetaNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return Math.round(num / 1000) + 'K';
    return num.toString();
}

function updateMetaStatus(status, text) {
    var el = document.getElementById('metaStatus');
    el.className = 'meta-status ' + status;
    el.textContent = text;
}

function updateMetaCount() {
    var count = Object.keys(META_SEGMENT_MAP).length;
    document.getElementById('metaLoadedCount').textContent = count + ' e≈üle≈üme';
}

function getMetaReachEstimate(interests) {
    var targetingSpec = {
        geo_locations: { countries: ['TR'] },
        age_min: 18,
        age_max: 65,
        flexible_spec: [{ interests: interests }]
    };
    var url = 'https://graph.facebook.com/' + META_CONFIG.apiVersion + '/act_' + META_CONFIG.adAccountId + '/reachestimate?targeting_spec=' + encodeURIComponent(JSON.stringify(targetingSpec)) + '&access_token=' + META_CONFIG.accessToken;
    
    return fetch(url)
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.error) throw new Error(data.error.message);
            return data.data;
        });
}

function loadSavedMappings() {
    var saved = localStorage.getItem('metaSegmentMappings');
    if (saved) {
        META_SEGMENT_MAP = JSON.parse(saved);
    }
}

function saveMappings() {
    localStorage.setItem('metaSegmentMappings', JSON.stringify(META_SEGMENT_MAP));
}

function searchInterest() {
    var query = document.getElementById('interestSearch').value;
    if (!query || query.length < 2) { alert('En az 2 karakter girin'); return; }
    
    var resultsDiv = document.getElementById('interestResults');
    resultsDiv.style.display = 'block';
    resultsDiv.innerHTML = '<p style="color:var(--text-secondary)">üîç Aranƒ±yor...</p>';
    
    var url = 'https://graph.facebook.com/' + META_CONFIG.apiVersion + '/search?type=adinterest&q=' + encodeURIComponent(query) + '&access_token=' + META_CONFIG.accessToken;
    
    fetch(url)
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.error) {
                resultsDiv.innerHTML = '<p style="color:#f87171">Hata: ' + data.error.message + '</p>';
                return;
            }
            if (!data.data || data.data.length === 0) {
                resultsDiv.innerHTML = '<p style="color:var(--text-secondary)">Sonu√ß bulunamadƒ±</p>';
                return;
            }
            
            var html = '<div style="margin-bottom:16px;padding:12px;background:rgba(0,212,255,0.1);border-radius:10px">' +
                '<div style="font-size:12px;color:var(--accent-blue);margin-bottom:8px;font-weight:600">üìå Segment se√ß:</div>' +
                '<select id="segmentSelector" style="width:100%;padding:10px;background:var(--bg-card);border:1px solid var(--border-color);border-radius:8px;color:var(--text-primary);font-size:12px">' +
                '<option value="">-- Segment Se√ß --</option>' + getAllSegmentOptions() + '</select></div>';
            
            data.data.slice(0, 8).forEach(function(interest) {
                html += '<div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg-card);border-radius:10px;margin-bottom:10px">' +
                    '<div style="flex:1"><div style="font-size:14px;font-weight:500">' + interest.name + '</div>' +
                    '<div style="font-size:11px;color:var(--text-secondary)">ID: ' + interest.id + '</div></div>' +
                    '<button onclick="assignInterestToSegment(\'' + interest.id + '\',\'' + interest.name.replace(/'/g, "\\'") + '\')" ' +
                    'style="padding:8px 16px;background:linear-gradient(135deg,#10b981,#059669);border:none;border-radius:8px;color:white;font-size:11px;cursor:pointer">‚úì Ata</button></div>';
            });
            
            resultsDiv.innerHTML = html;
        })
        .catch(function(err) {
            resultsDiv.innerHTML = '<p style="color:#f87171">Hata: ' + err.message + '</p>';
        });
}

function getAllSegmentOptions() {
    var options = '';
    segments.forEach(function(parent) {
        options += '<optgroup label="' + parent.icon + ' ' + parent.name + '">';
        parent.subs.forEach(function(sub) {
            var currentInterest = META_SEGMENT_MAP[sub.id] ? META_SEGMENT_MAP[sub.id].interests[0].name : 'Atanmamƒ±≈ü';
            options += '<option value="' + sub.id + '">' + sub.name + ' (' + currentInterest + ')</option>';
        });
        options += '</optgroup>';
    });
    return options;
}

function assignInterestToSegment(interestId, interestName) {
    var selector = document.getElementById('segmentSelector');
    var segmentId = selector.value;
    if (!segmentId) { alert('L√ºtfen √∂nce bir segment se√ßin!'); return; }
    
    var seg = findSegment(segmentId);
    META_SEGMENT_MAP[segmentId] = {
        name: seg ? seg.name : segmentId,
        interests: [{ id: interestId, name: interestName }]
    };
    saveMappings();
    updateMetaCount();
    selector.innerHTML = '<option value="">-- Segment Se√ß --</option>' + getAllSegmentOptions();
    renderSegments();
    showToast(interestName + ' ‚Üí ' + (seg ? seg.name : segmentId), 'success');
}

function showMappingsModal() {
    var modal = document.createElement('div');
    modal.id = 'mappingsModal';
    modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:10000';
    
    var html = '';
    Object.keys(META_SEGMENT_MAP).forEach(function(segId) {
        var data = META_SEGMENT_MAP[segId];
        var segName = findSegment(segId) ? findSegment(segId).name : segId;
        var interestName = data.interests[0].name;
        html += '<div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg-secondary);border-radius:8px;margin-bottom:8px">' +
            '<div><div style="font-size:13px;font-weight:500">' + segName + '</div><div style="font-size:11px;color:var(--accent-blue)">‚Üí ' + interestName + '</div></div>' +
            '<button onclick="removeMapping(\'' + segId + '\')" style="padding:6px 12px;background:#ef4444;border:none;border-radius:6px;color:white;font-size:11px;cursor:pointer">Sil</button></div>';
    });
    
    modal.innerHTML = '<div style="background:var(--bg-card);border-radius:16px;width:520px;max-height:80vh;overflow:hidden;border:1px solid var(--border-color)">' +
        '<div style="padding:18px 22px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center">' +
        '<h3 style="font-size:15px;color:var(--accent-blue)">üìã E≈üle≈ütirmeler (' + Object.keys(META_SEGMENT_MAP).length + ')</h3>' +
        '<button onclick="document.getElementById(\'mappingsModal\').remove()" style="background:none;border:none;color:var(--text-secondary);font-size:20px;cursor:pointer">‚úï</button></div>' +
        '<div style="padding:20px;max-height:60vh;overflow-y:auto">' + (html || '<p style="color:var(--text-secondary)">Hen√ºz e≈üle≈ütirme yok</p>') + '</div>' +
        '<div style="padding:16px 22px;border-top:1px solid var(--border-color);display:flex;gap:12px;justify-content:flex-end">' +
        '<button onclick="clearAllMappings()" style="padding:10px 18px;background:#ef4444;border:none;border-radius:8px;color:white;font-size:12px;cursor:pointer">T√ºm√ºn√º Sil</button>' +
        '<button onclick="exportMappings()" style="padding:10px 18px;background:var(--accent-blue);border:none;border-radius:8px;color:#000;font-size:12px;cursor:pointer">üì• JSON</button></div></div>';
    
    document.body.appendChild(modal);
}

function removeMapping(segId) {
    delete META_SEGMENT_MAP[segId];
    delete metaDataCache[segId];
    saveMappings();
    updateMetaCount();
    document.getElementById('mappingsModal').remove();
    showMappingsModal();
    renderSegments();
}

function clearAllMappings() {
    if (confirm('T√ºm e≈üle≈ütirmeleri silmek istediƒüinize emin misiniz?')) {
        META_SEGMENT_MAP = {};
        metaDataCache = {};
        localStorage.removeItem('metaSegmentMappings');
        updateMetaCount();
        document.getElementById('mappingsModal').remove();
        showToast('T√ºm e≈üle≈ütirmeler silindi', 'info');
        renderSegments();
    }
}

function exportMappings() {
    var data = JSON.stringify(META_SEGMENT_MAP, null, 2);
    var blob = new Blob([data], { type: 'application/json' });
    var a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'segment-interest-mappings.json';
    a.click();
    showToast('E≈üle≈ütirmeler JSON olarak indirildi', 'success');
}

function exportSelection() {
    var btn = event.currentTarget;
    setButtonLoading(btn, true);
    
    setTimeout(function() {
        var csv = 'Segment,A√ßƒ±klama,Reach,Meta Interest\n';
        selectedSegments.forEach(function(segId) {
            var s = findSegment(segId);
            var interest = META_SEGMENT_MAP[segId] ? META_SEGMENT_MAP[segId].interests[0].name : '';
            if (s) csv += '"' + s.name + '","' + s.desc + '",' + s.reach + '%,"' + interest + '"\n';
        });
        var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        var a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'secili_segmentler.csv';
        a.click();
        document.getElementById('step4').classList.add('completed');
        showToast(selectedSegments.size + ' segment CSV olarak indirildi', 'success');
        setButtonLoading(btn, false);
    }, 500);
}

function goToQuadrant() {
    if (selectedSegments.size === 0) { alert('L√ºtfen en az bir segment se√ßin'); return; }
    var btn = event.currentTarget;
    setButtonLoading(btn, true);
    
    var selectedData = [];
    selectedSegments.forEach(function(segId) {
        for (var i = 0; i < segments.length; i++) {
            var sub = segments[i].subs.find(function(s) { return s.id === segId; });
            if (sub) {
                selectedData.push({ id: sub.id, name: sub.name, desc: sub.desc, reach: sub.reach * 100000, parent: segments[i].name });
                break;
            }
        }
    });
    localStorage.setItem('selectedSegments', JSON.stringify(selectedData));
    localStorage.setItem('metaSegmentMappings', JSON.stringify(META_SEGMENT_MAP));
    document.getElementById('step3').classList.add('completed');
    showToast('Quadrant\'a y√∂nlendiriliyor...', 'info');
    setTimeout(function() { window.location.href = 'segmentation-quadrant.html'; }, 600);
}

// === LOADING BUTTON HELPER ===
var spinnerSVG = '<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" opacity="0.25"/><path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/></svg>';

function setButtonLoading(btn, isLoading) {
    if (!btn) return;
    
    if (isLoading) {
        btn.dataset.originalHtml = btn.innerHTML;
        btn.classList.add('btn-loading');
        btn.disabled = true;
        btn.innerHTML = '<span class="btn-text">' + btn.innerHTML + '</span><span class="btn-spinner">' + spinnerSVG + '</span>';
    } else {
        btn.classList.remove('btn-loading');
        btn.disabled = false;
        if (btn.dataset.originalHtml) {
            btn.innerHTML = btn.dataset.originalHtml;
        }
    }
}

// === TOAST NOTIFICATION SYSTEM ===
(function() {
    // Create toast container
    var container = document.createElement('div');
    container.className = 'toast-container';
    container.id = 'toastContainer';
    document.body.appendChild(container);
    
    // Toast function
    window.showToast = function(message, type, duration) {
        type = type || 'success';
        duration = duration || 4000;
        
        var icons = {
            success: '<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6 9 17l-5-5"/></svg>',
            error: '<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',
            info: '<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>',
            warning: '<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>'
        };
        
        var toast = document.createElement('div');
        toast.className = 'toast toast-' + type;
        toast.innerHTML = '<div class="toast-icon">' + icons[type] + '</div>' +
            '<div class="toast-content"><div class="toast-message">' + message + '</div></div>' +
            '<button class="toast-close" onclick="this.parentElement.remove()">' +
            '<svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>' +
            '<div class="toast-progress" style="animation-duration:' + duration + 'ms"></div>';
        
        container.appendChild(toast);
        
        // Animate in
        requestAnimationFrame(function() {
            toast.classList.add('visible');
        });
        
        // Auto dismiss
        setTimeout(function() {
            toast.classList.add('hiding');
            toast.classList.remove('visible');
            setTimeout(function() { toast.remove(); }, 300);
        }, duration);
        
        return toast;
    };
})();

init();
    </script>
</body>
</html>
